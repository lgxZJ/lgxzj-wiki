(this["webpackJsonpreact-monitors"]=this["webpackJsonpreact-monitors"]||[]).push([[0],{198:function(e,t,a){e.exports=a(324)},202:function(e,t,a){},203:function(e,t,a){},324:function(e,t,a){"use strict";a.r(t);var r=a(2),i=a.n(r),n=a(17),l=a.n(n),o=(a(202),a(203),a(43)),s=a(78),c=a(62),u=a(63),p=a(54),h=a(68),f=a(67),m=a(331),d=a(34),y=a(330),g=a(329),v=a(71),_=a(98),b=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.xFieldName,t=this.props.yFieldName,a=this.props.pointsData,r={title:{visible:!1,text:this.props.title},description:{visible:!0,text:this.props.desc},xField:e,yField:t,seriesField:this.props.seriesField,data:a,padding:"auto",forceFit:!0,label:{visible:!0,type:"point"},point:{visible:!0,size:2,shape:"circle",style:{fill:"white",stroke:"#2593fc",lineWidth:1}},legend:{position:"right-top"},yAxis:this.props.yAxis};return i.a.createElement("div",null,i.a.createElement(_.b,r),";")}}]),a}(i.a.Component),D=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=[0,.5,.85,1],t=[];this.props.data.forEach((function(a){t.push({title:a.bulletTitle,measures:[a.bulletMeasure],targets:[85],ranges:e})}));var a={title:{visible:!1,text:this.props.chartTitle},description:{visible:!0,text:this.props.chartDesc},data:t,rangeMax:100,rangeColors:["#B4EBBF","#FFDBA2","#FFB1AC"]};return i.a.createElement(_.a,a)}}]),a}(i.a.Component);function k(){return window.location!==window.parent.location}function x(){if(k()){var e,t=(e=document.getElementById("root"),Math.max(e.scrollHeight,e.scrollHeight)),a=parent.document.getElementById("ifr");null!==a&&(console.log("changing parent iframe('ifr') to size:",t),a.style.height=t+"px")}else console.log("not inside iframe, no need to change iframe size")}k()&&(document.domain="lgxzj.wiki"),window.onload=x,window.addEventListener("message",(function(e){if("FrameHeight"===e.data){var t=document.body,a=document.documentElement,r=Math.max(t.scrollHeight,t.offsetHeight,a.clientHeight,a.scrollHeight,a.offsetHeight);e.source.postMessage({FrameHeight:r},"*")}}));var w=x,C=(a(248),m.a.Panel),E=a(265).default,F=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).state={xFieldName:"x",yFieldName:"y",seriesField:"type",chartDataArray:[{panelTitle:"Cpu & Mem",chartConfigs:[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"cpu",chartType:"line",title:"CPU \u8d1f\u8f7d",desc:"\u6309cpu\u5206\u7ec4\u7684\u8d1f\u8f7d\u7387",yAxis:{visible:!0,min:0,max:110,tickCount:5},loading:!0},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"mem",chartType:"line",title:"\u5185\u5b58 \u8d1f\u8f7d",desc:"\u5185\u5b58\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5355\u4f4dMB",yAxis:{visible:!0,min:0,max:4400,tickCount:5},loading:!0}]},{panelTitle:"Network",chartConfigs:[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"net_io",chartType:"line",title:"\u7f51\u7edc IO",desc:"\u7f51\u7edc\u6536\u53d1\u8d1f\u8f7d\uff0c\u5355\u4f4dKB",loading:!0}]},{panelTitle:"Disk IO & Caps",chartConfigs:[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"disk_io",chartType:"line",title:"\u78c1\u76d8 IO",desc:"\u78c1\u76d8\u8bfb\u5199\u8d1f\u8f7d\uff0c\u5355\u4f4dKB",loading:!0},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"disk_cap",chartType:"line",title:"\u78c1\u76d8 \u5bb9\u91cf",desc:"\u78c1\u76d8\u4f7f\u7528\u60c5\u51b5\uff0c\u5355\u4f4dGB",yAxis:{visible:!0,min:0,max:100,tickCount:5},loading:!0}]},{panelTitle:"Proc Intensives",chartConfigs:[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query",pointsData:[],type:"proc_top_cpu",chartType:"bullet",title:"CPU\u6d3b\u8dc3TOP10",desc:"CPU\u6d3b\u8dc3\u8fdb\u7a0b\uff0c\u5355\u4f4d\u767e\u5206\u6bd4",loading:!0},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query",pointsData:[],type:"proc_top_mem",chartType:"bullet",title:"MEM\u6d3b\u8dc3TOP10",desc:"CPU\u6d3b\u8dc3\u8fdb\u7a0b\uff0c\u5355\u4f4d\u767e\u5206\u6bd4",loading:!0}]}]},r.fetchData=r.fetchData.bind(Object(p.a)(r)),r.fetchCpuData=r.fetchCpuData.bind(Object(p.a)(r)),r.genQueryTimeRange=r.genQueryTimeRange.bind(Object(p.a)(r)),r.panelChanged=r.panelChanged.bind(Object(p.a)(r)),r}return Object(u.a)(a,[{key:"panelChanged",value:function(){setTimeout(w,500)}},{key:"genQueryTimeRange",value:function(){var e=Math.floor(Date.now()/1e3);return{start:e-5,end:e,step:"1s"}}},{key:"rowIdx2Key",value:function(e){return"row_"+e.toString()}},{key:"unixTimestamp2DateFormat",value:function(e){return new Date(1e3*e).Format("HH:mm:ss")}},{key:"stringValue2Int",value:function(e){return parseInt(e)}},{key:"getResultFromResponse",value:function(e){return e.data.data.result}},{key:"updateChartData2State",value:function(e,t,a,r,i){this.setState((function(e){var a=JSON.parse(JSON.stringify(e)),n=a.chartDataArray[t].chartConfigs[r];return n.pointsData=i,n.loading=!1,a}))}},{key:"updateChartLoading2State",value:function(e,t,a,r,i){this.setState((function(e){var a=JSON.parse(JSON.stringify(e));return a.chartDataArray[t].chartConfigs[r].loading=i,a}))}},{key:"fetchCpuData",value:function(e,t,a,r){var i=this,n=this.genQueryTimeRange(),l=this.state.chartDataArray[t].chartConfigs[r].queryUrl;this.updateChartLoading2State(e,t,a,r,!0),E.get(l,{params:Object(s.a)(Object(s.a)({},n),{},{query:'100 - (irate(node_cpu_seconds_total{mode="idle"}[15s]) * 100)'})}).then((function(n){var l=i.getResultFromResponse(n),s=[];l.forEach((function(e,t){var a=e.values,r=e.metric.cpu;a.forEach((function(e){var t,a=i.unixTimestamp2DateFormat(e[0]),n=i.stringValue2Int(e[1]);s.push((t={},Object(o.a)(t,i.state.xFieldName,a),Object(o.a)(t,i.state.yFieldName,n),Object(o.a)(t,i.state.seriesField,"cpu"+r),t))}))})),i.updateChartData2State(e,t,a,r,s)})).catch((function(e){console.log("get node metrics failed",e)}))}},{key:"fetchDataParallel",value:function(e,t,a,r,i,n,l){var c=this,u=this.genQueryTimeRange(),p=this.state.chartDataArray[t].chartConfigs[r],h=p.queryUrl;this.updateChartLoading2State(e,t,a,r,!0);var f=[];i.forEach((function(e){f.push(E.get(h,{params:Object(s.a)(Object(s.a)({},u),{},{query:e.query})}))}));var m=function(e,t,a,r,s){var u;null!=n&&(s=n(s));var h=i[t].label;if(null!=l){var f=l(e);null!=f&&(h+="_"+f)}switch(p.type){case"proc_top_mem":case"proc_top_cpu":return{bulletTitle:a,bulletMeasure:s};default:return u={},Object(o.a)(u,c.state.xFieldName,r),Object(o.a)(u,c.state.yFieldName,s),Object(o.a)(u,c.state.seriesField,h),u}};Promise.all(f).then((function(i){var n=[];i.forEach((function(e,t){c.getResultFromResponse(e).forEach((function(e){if("proc_top_cpu"===p.type||"proc_top_mem"===p.type){var a=e.metric.proc,r=c.unixTimestamp2DateFormat(e.value[0]),i=parseFloat(e.value[1]);n.push(m(e,t,a,r,i))}else{var l=e.values;l.forEach((function(a){var r=c.unixTimestamp2DateFormat(a[0]),i=c.stringValue2Int(a[1]);n.push(m(e,t,null,r,i))}))}}))})),"proc_top_cpu"!==p.type&&"proc_top_mem"!==p.type||(console.log("before update",n),n.sort((function(e,t){return parseInt(t.bulletMeasure)-parseInt(e.bulletMeasure)})),console.log("after update",n)),c.updateChartData2State(e,t,a,r,n)})).catch((function(e){console.log("get metrics failed",e)}))}},{key:"fetchMemDataParallel",value:function(e,t,a,r,i){this.fetchDataParallel(e,t,a,r,i,(function(e){return Math.floor(e/1024/1024)}),null)}},{key:"fetchMemData",value:function(e,t,a,r){this.fetchMemDataParallel(e,t,a,r,[{query:"node_memory_MemTotal_bytes",label:"mem_total"},{query:"node_memory_MemFree_bytes",label:"mem_free"}],[])}},{key:"fetchDiskIODataParallel",value:function(e,t,a,r,i){this.fetchDataParallel(e,t,a,r,i,null,(function(e){return null!=e.metric.device?e.metric.device:null}))}},{key:"fetchDiskIOData",value:function(e,t,a,r){this.fetchDiskIODataParallel(e,t,a,r,[{query:"irate(node_disk_written_bytes_total[15s])",label:"written"},{query:"irate(node_disk_read_bytes_total[15s])",label:"read"},{query:"irate(node_textfile_scrape_error[15s])",label:"open_err"}])}},{key:"fetchNetworkIOData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"irate(node_network_receive_bytes_total[15s])",label:"recv"},{query:"irate(node_network_receive_errs_total[15s])",label:"recv_err"},{query:"irate(node_network_transmit_bytes_total[15s])",label:"sent"},{query:"irate(node_network_transmit_errs_total[15s])",label:"sent_err"}],(function(e){return Math.floor(e/1024)}),(function(e){return e.metric.device}))}},{key:"fetchProcCpuTopData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"ps_pusher_cpu",label:""}],(function(e){return e}),null)}},{key:"fetchProcMemTopData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"ps_pusher_mem",label:""}],(function(e){return e}),null)}},{key:"fetchDiskCapacityData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"node_filesystem_size_bytes",label:"size_total"},{query:"node_filesystem_size_bytes-node_filesystem_avail_bytes",label:"size_used"}],(function(e){return Math.floor(e/1024/1024/1024)}),(function(e){return e.metric.device}))}},{key:"fetchData",value:function(){var e=this;this.state.chartDataArray.forEach((function(t,a){var r=t.chartConfigs;r.forEach((function(t,i){switch(t.type){case"cpu":e.fetchCpuData(r,a,t,i);break;case"mem":e.fetchMemData(r,a,t,i);break;case"disk_io":e.fetchDiskIOData(r,a,t,i);break;case"disk_cap":e.fetchDiskCapacityData(r,a,t,i);break;case"net_io":e.fetchNetworkIOData(r,a,t,i);break;case"proc_top_cpu":e.fetchProcCpuTopData(r,a,t,i);break;case"proc_top_mem":e.fetchProcMemTopData(r,a,t,i)}}))}))}},{key:"componentDidMount",value:function(){this.fetchData();setInterval(this.fetchData,3e3)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.chartDataArray.length;++t){for(var a=[],r=this.state.chartDataArray[t].chartConfigs,n=this.state.chartDataArray[t].panelTitle,l=0;l<r.length;++l){var o="col_"+t.toString()+"_"+l.toString(),s=r[l];if("line"===s.chartType){var c={xFieldName:this.state.xFieldName,yFieldName:this.state.yFieldName,seriesField:this.state.seriesField,pointsData:s.pointsData,title:s.title,desc:s.desc,yAxis:s.yAxis};a.push(i.a.createElement(d.a,{key:o,span:12},i.a.createElement(y.a,{title:s.title},s.loading?i.a.createElement(g.a,null,i.a.createElement(b,c)):i.a.createElement(b,c))))}if("bullet"===s.chartType){var u={data:s.pointsData,chartTitle:s.title,chartDesc:s.desc};a.push(i.a.createElement(d.a,{key:o,span:12},i.a.createElement(y.a,{title:s.title},s.loading?i.a.createElement(g.a,null,i.a.createElement(D,u)):i.a.createElement(D,u))))}}var p=this.rowIdx2Key(t);e.push(i.a.createElement(C,{header:n,key:p},i.a.createElement(v.a,{key:p,gutter:[16,16]},a)))}return i.a.createElement("div",null,i.a.createElement(m.a,{defaultActiveKey:[this.rowIdx2Key(0)],onChange:this.panelChanged},e))}}]),a}(i.a.Component);Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var O=F;var T=function(){return i.a.createElement(O,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[198,1,2]]]);
//# sourceMappingURL=main.607a45f2.chunk.js.map