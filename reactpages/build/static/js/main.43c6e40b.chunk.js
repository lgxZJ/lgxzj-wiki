(this["webpackJsonpreact-monitors"]=this["webpackJsonpreact-monitors"]||[]).push([[0],{126:function(e,t,a){e.exports=a(195)},130:function(e,t,a){},131:function(e,t,a){},195:function(e,t,a){"use strict";a.r(t);var r=a(2),i=a.n(r),n=a(46),l=a.n(n),s=(a(130),a(131),a(26)),o=a(48),c=a(35),u=a(36),p=a(41),h=a(40),m=a(39),y=a(201),f=a(200),d=a(60),v=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.xFieldName,t=this.props.yFieldName,a=this.props.pointsData,r={title:{visible:!0,text:this.props.title},description:{visible:!0,text:this.props.desc},xField:e,yField:t,seriesField:this.props.seriesField,data:a,padding:"auto",forceFit:!0,label:{visible:!0,type:"point"},point:{visible:!0,size:2,shape:"circle",style:{fill:"white",stroke:"#2593fc",lineWidth:2}},legend:{position:"right-top"},yAxis:this.props.yAxis};return i.a.createElement("div",null,i.a.createElement(d.b,r),";")}}]),a}(i.a.Component),_=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=[0,.5,.85,1],t=[];this.props.data.forEach((function(a){t.push({title:a.bulletTitle,measures:[a.bulletMeasure],targets:[85],ranges:e})}));var a={title:{visible:!0,text:this.props.chartTitle},data:t,rangeMax:100,rangeColors:["#FFB1AC","#FFDBA2","#B4EBBF"],legend:{custom:!0,items:[{name:"\u5b9e\u9645\u8fdb\u5ea6",marker:{symbol:"square",style:{fill:"#5B8FF9"}}},{name:"\u76ee\u6807\u503c",marker:{symbol:"line",style:{stroke:"#5B8FF9"}}},{name:"\u5dee",marker:{symbol:"square",style:{fill:"#FFB1AC"}}},{name:"\u826f",marker:{symbol:"square",style:{fill:"#FFDBA2"}}},{name:"\u4f18",marker:{symbol:"square",style:{fill:"#B4EBBF"}}}]}};return i.a.createElement(d.a,a)}}]),a}(i.a.Component),b=(a(177),a(178).default),g=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var r;Object(c.a)(this,a),(r=t.call(this,e)).state={loading:!0,xFieldName:"x",yFieldName:"y",seriesField:"type",chartDataArray:[[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"cpu",chartType:"line",title:"CPU \u8d1f\u8f7d",desc:"\u6309cpu\u5206\u7ec4\u7684\u8d1f\u8f7d\u7387",yAxis:{visible:!0,min:0,max:110,tickCount:5}},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"mem",chartType:"line",title:"\u5185\u5b58 \u8d1f\u8f7d",desc:"\u5185\u5b58\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\uff0c\u5355\u4f4dMB",yAxis:{visible:!0,min:0,max:4400,tickCount:5}},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"net_io",chartType:"line",title:"\u7f51\u7edc IO",desc:"\u7f51\u7edc\u6536\u53d1\u8d1f\u8f7d\uff0c\u5355\u4f4dKB"}],[{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"disk_io",chartType:"line",title:"\u78c1\u76d8 IO",desc:"\u78c1\u76d8\u8bfb\u5199\u8d1f\u8f7d\uff0c\u5355\u4f4dKB"},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query_range",pointsData:[],type:"disk_cap",chartType:"line",title:"\u78c1\u76d8 \u5bb9\u91cf",desc:"\u78c1\u76d8\u4f7f\u7528\u60c5\u51b5\uff0c\u5355\u4f4dGB",yAxis:{visible:!0,min:0,max:100,tickCount:5}},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query",pointsData:[],type:"proc_top_cpu",chartType:"bullet",title:"CPU\u6d3b\u8dc3TOP10\uff08\u767e\u5206\u6bd4\uff09",desc:"CPU\u6d3b\u8dc3\u8fdb\u7a0b\uff0c\u5355\u4f4d\u767e\u5206\u6bd4"},{queryUrl:"http://metric.lgxzj.wiki/api/v1/query",pointsData:[],type:"proc_top_mem",chartType:"bullet",title:"MEM\u6d3b\u8dc3TOP10\uff08\u767e\u5206\u6bd4\uff09",desc:"CPU\u6d3b\u8dc3\u8fdb\u7a0b\uff0c\u5355\u4f4d\u767e\u5206\u6bd4"}]]},r.fetchData=r.fetchData.bind(Object(p.a)(r)),r.fetchCpuData=r.fetchCpuData.bind(Object(p.a)(r)),r.genQueryTimeRange=r.genQueryTimeRange.bind(Object(p.a)(r));return setInterval(r.fetchData,3e3),r}return Object(u.a)(a,[{key:"genQueryTimeRange",value:function(){var e=Math.floor(Date.now()/1e3);return{start:e-5,end:e,step:"1s"}}},{key:"unixTimestamp2DateFormat",value:function(e){return new Date(1e3*e).Format("HH:mm:ss")}},{key:"stringValue2Int",value:function(e){return parseInt(e)}},{key:"getResultFromResponse",value:function(e){return e.data.data.result}},{key:"updateChartData2State",value:function(e,t,a,r,i){e[r].pointsData=i,this.setState((function(e){var a=JSON.parse(JSON.stringify(e));return a.chartDataArray[t][r].pointsData=i,a}))}},{key:"fetchCpuData",value:function(e,t,a,r){var i=this,n=this.genQueryTimeRange(),l=this.state.chartDataArray[t][r].queryUrl;b.get(l,{params:Object(o.a)(Object(o.a)({},n),{},{query:'100 - (irate(node_cpu_seconds_total{mode="idle"}[15s]) * 100)'})}).then((function(n){var l=i.getResultFromResponse(n),o=[];l.forEach((function(e,t){var a=e.values,r=e.metric.cpu;a.forEach((function(e){var t,a=i.unixTimestamp2DateFormat(e[0]),n=i.stringValue2Int(e[1]);o.push((t={},Object(s.a)(t,i.state.xFieldName,a),Object(s.a)(t,i.state.yFieldName,n),Object(s.a)(t,i.state.seriesField,"cpu"+r),t))}))})),i.updateChartData2State(e,t,a,r,o)})).catch((function(e){console.log("get node metrics failed",e)}))}},{key:"fetchDataParallel",value:function(e,t,a,r,i,n,l){var c=this,u=this.genQueryTimeRange(),p=this.state.chartDataArray[t][r],h=this.state.chartDataArray[t][r].queryUrl,m=[];i.forEach((function(e){m.push(b.get(h,{params:Object(o.a)(Object(o.a)({},u),{},{query:e.query})}))}));var y=function(e,t,a,r,o){var u;null!=n&&(o=n(o));var h=i[t].label;if(null!=l){var m=l(e);null!=m&&(h+="_"+m)}switch(p.type){case"proc_top_mem":case"proc_top_cpu":return{bulletTitle:a,bulletMeasure:o};default:return u={},Object(s.a)(u,c.state.xFieldName,r),Object(s.a)(u,c.state.yFieldName,o),Object(s.a)(u,c.state.seriesField,h),u}};Promise.all(m).then((function(i){var n=[];console.log("resArray",i),i.forEach((function(e,t){c.getResultFromResponse(e).forEach((function(e){if("proc_top_cpu"===p.type||"proc_top_mem"===p.type){var a=e.metric.proc,r=c.unixTimestamp2DateFormat(e.value[0]),i=e.value[1];n.push(y(e,t,a,r,i)),console.log("before sort",n),n.sort((function(e,t){return e.bulletMeasure-t.bulletMeasure})),console.log("after sort",n)}else{var l=e.values;l.forEach((function(a){var r=c.unixTimestamp2DateFormat(a[0]),i=c.stringValue2Int(a[1]);n.push(y(e,t,null,r,i))}))}}))})),c.updateChartData2State(e,t,a,r,n)})).catch((function(e){console.log("get metrics failed",e)}))}},{key:"fetchMemDataParallel",value:function(e,t,a,r,i){this.fetchDataParallel(e,t,a,r,i,(function(e){return Math.floor(e/1024/1024)}),null)}},{key:"fetchMemData",value:function(e,t,a,r){this.fetchMemDataParallel(e,t,a,r,[{query:"node_memory_MemTotal_bytes",label:"mem_total"},{query:"node_memory_MemFree_bytes",label:"mem_free"}],[])}},{key:"fetchDiskIODataParallel",value:function(e,t,a,r,i){this.fetchDataParallel(e,t,a,r,i,null,(function(e){return null!=e.metric.device?e.metric.device:null}))}},{key:"fetchDiskIOData",value:function(e,t,a,r){this.fetchDiskIODataParallel(e,t,a,r,[{query:"irate(node_disk_written_bytes_total[15s])",label:"written"},{query:"irate(node_disk_read_bytes_total[15s])",label:"read"},{query:"irate(node_textfile_scrape_error[15s])",label:"open_err"}])}},{key:"fetchNetworkIOData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"irate(node_network_receive_bytes_total[15s])",label:"recv"},{query:"irate(node_network_receive_errs_total[15s])",label:"recv_err"},{query:"irate(node_network_transmit_bytes_total[15s])",label:"sent"},{query:"irate(node_network_transmit_errs_total[15s])",label:"sent_err"}],(function(e){return Math.floor(e/1024)}),(function(e){return e.metric.device}))}},{key:"fetchProcCpuTopData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"ps_pusher_cpu",label:""}],(function(e){return e}),null)}},{key:"fetchProcMemTopData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"ps_pusher_mem",label:""}],(function(e){return e}),null)}},{key:"fetchDiskCapacityData",value:function(e,t,a,r){this.fetchDataParallel(e,t,a,r,[{query:"node_filesystem_size_bytes",label:"size_total"},{query:"node_filesystem_size_bytes-node_filesystem_avail_bytes",label:"size_used"}],(function(e){return Math.floor(e/1024/1024/1024)}),(function(e){return console.log("disk_cap",e.metric.device),e.metric.device}))}},{key:"fetchData",value:function(){var e=this;this.state.chartDataArray.forEach((function(t,a){t.forEach((function(r,i){switch(r.type){case"cpu":e.fetchCpuData(t,a,r,i);break;case"mem":e.fetchMemData(t,a,r,i);break;case"disk_io":e.fetchDiskIOData(t,a,r,i);break;case"disk_cap":e.fetchDiskCapacityData(t,a,r,i);break;case"net_io":e.fetchNetworkIOData(t,a,r,i);break;case"proc_top_cpu":e.fetchProcCpuTopData(t,a,r,i);break;case"proc_top_mem":e.fetchProcMemTopData(t,a,r,i)}}))}))}},{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.chartDataArray.length;++t){for(var a=[],r=0;r<this.state.chartDataArray[t].length;++r){var n="col_"+t.toString()+"_"+r.toString(),l=this.state.chartDataArray[t][r];if("line"===l.chartType){var s={xFieldName:this.state.xFieldName,yFieldName:this.state.yFieldName,seriesField:this.state.seriesField,pointsData:l.pointsData,title:l.title,desc:l.desc,yAxis:l.yAxis};a.push(i.a.createElement(y.a,{key:n,span:8},i.a.createElement(v,s)))}if("bullet"===l.chartType){var o={data:l.pointsData,chartTitle:l.title};console.log("====",o),a.push(i.a.createElement(y.a,{key:n,span:8},i.a.createElement(_,o)))}}var c="row_"+t.toString();e.push(i.a.createElement(f.a,{key:c,gutter:[16,16]},a))}return i.a.createElement("div",null,e)}}]),a}(i.a.Component);Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};var D=g;var k=function(){return i.a.createElement(D,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[126,1,2]]]);
//# sourceMappingURL=main.43c6e40b.chunk.js.map